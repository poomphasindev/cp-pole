<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ò‡∏≠ V2.0 üíñ</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        /* =====================================================
        üé® ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡∏´‡∏•‡∏±‡∏Å (Customization Section) üé®
        ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        ===================================================== */
        :root {
            /* --- üé® ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ --- */
            --primary-color: #ff8fab;      /* ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡∏´‡∏•‡∏±‡∏Å (‡∏õ‡∏∏‡πà‡∏°, ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå) */
            --secondary-color: #f3a6b1;    /* ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡∏£‡∏≠‡∏á */
            --background-color: #fff0f5;   /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (‡∏ä‡∏°‡∏û‡∏π‡∏≠‡πà‡∏≠‡∏ô‡πÜ) */
            --text-color: #583c3c;         /* ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏•‡∏±‡∏Å (‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÄ‡∏Ç‡πâ‡∏°) */
            --light-text-color: #ffffff;   /* ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏° (‡∏Ç‡∏≤‡∏ß) */
            --border-color: #ffd1dc;       /* ‡∏™‡∏µ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö (‡∏ä‡∏°‡∏û‡∏π‡∏≠‡πà‡∏≠‡∏ô) */
            --card-bg-color: #ffffff;      /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î (‡∏Ç‡∏≤‡∏ß) */
            --today-highlight: #ffc2d1;    /* ‡∏™‡∏µ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô */
            --completed-color: #60d394;    /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß */
            
            /* --- üî† ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å --- */
            --main-font: 'Mitr', sans-serif;
        }
        /* ===================================================== */

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--main-font);
            background-color: var(--background-color);
            color: var(--text-color);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--card-bg-color);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* === ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß === */
        .header {
            background: var(--primary-color);
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            padding: 30px;
            text-align: center;
            color: white;
            position: relative;
        }

        .profile-frame {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.8);
            position: absolute;
            top: 20px;
            right: 30px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .profile-frame:hover {
            transform: scale(1.1);
        }
        .profile-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .profile-frame-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            font-size: 2rem;
            color: rgba(255, 255, 255, 0.7);
        }


        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        /* === ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà!) === */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            padding: 20px 30px;
            background: #fff7f9;
            border-bottom: 1px solid var(--border-color);
        }
        .stat-card {
            background: var(--card-bg-color);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(255, 143, 171, 0.2);
        }
        .stat-number {
            font-size: 2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        .stat-label {
            color: var(--secondary-color);
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* === ‡πÅ‡∏ñ‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ === */
        .toolbar {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 143, 171, 0.4);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 143, 171, 0.5);
        }
        
        .month-navigation { display: flex; align-items: center; gap: 15px; }
        .month-nav-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }
        .month-nav-btn:hover {
            background: var(--primary-color);
            transform: scale(1.1);
        }
        .current-month {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-color);
            min-width: 200px;
            text-align: center;
        }
        
        /* === ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô === */
        .calendar-container { padding: 30px; }
        .calendar {
            width: 100%;
            border-collapse: collapse;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }
        .calendar th {
            background: var(--secondary-color);
            color: white;
            padding: 15px;
            font-weight: 500;
        }
        .calendar td {
            width: 14.28%;
            height: 120px;
            border: 1px solid var(--border-color);
            vertical-align: top;
            padding: 5px;
            position: relative;
            background: white;
            transition: all 0.3s ease;
        }
        .calendar td:hover {
            background: #fff7f9;
        }
        .date-number {
            font-weight: 500;
            color: var(--text-color);
            font-size: 1rem;
            margin-left: 3px;
        }
        .other-month .date-number { color: #ccc; }
        .today { background: var(--today-highlight); }
        .today .date-number {
            color: var(--primary-color);
            font-weight: 600;
        }

        /* === ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô (‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô) === */
        .reading-task {
            background: var(--secondary-color);
            color: white;
            padding: 4px 8px;
            margin-top: 5px;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .reading-task:hover {
            transform: scale(1.05);
            background: var(--primary-color);
        }
        .reading-task.completed {
            background: var(--completed-color);
            text-decoration: line-through;
            opacity: 0.8;
        }

        /* === ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà!) === */
        .task-list-container {
            background: #fff7f9;
            padding: 30px;
        }
        .task-list {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        .task-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        .task-item:last-child { border-bottom: none; }
        .task-checkbox {
            width: 20px;
            height: 20px;
            border-radius: 5px;
            border: 2px solid var(--secondary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        .task-checkbox.completed {
            background: var(--primary-color);
            border-color: var(--primary-color);
            position: relative;
        }
        .task-checkbox.completed::after {
            content: "‚úî";
            color: white;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.8rem;
        }

        /* === ‡πÇ‡∏°‡∏î‡∏±‡∏• (‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á Pop-up) === */
        .modal {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center; align-items: center;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: white; border-radius: 20px;
            padding: 30px; max-width: 500px; width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transform: scale(0.9); transition: all 0.3s ease;
        }
        .modal.show .modal-content { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;}
        .modal-title { font-size: 1.5rem; font-weight: 500; color: var(--primary-color); }
        .close-btn { background: none; border: none; font-size: 1.8rem; cursor: pointer; color: #aaa; transition: color 0.3s ease; }
        .close-btn:hover { color: var(--primary-color); }

        /* === ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ô‡πÇ‡∏°‡∏î‡∏±‡∏• === */
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-color); }
        .form-input {
            width: 100%; padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 10px; font-family: inherit;
            transition: all 0.3s ease;
        }
        .form-input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(255, 143, 171, 0.2); }

    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <div class="profile-frame" id="profileFrame" title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå">
                <div class="profile-frame-placeholder">üíñ</div>
            </div>
            <h1>‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏≠‡πâ‡∏ß‡∏ô</h1>
            <p>‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏™‡∏°‡∏≠‡∏™‡∏π‡πâ‡πÜ</p>
        </div>

        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number" id="totalTasks">0</div>
                <div class="stat-label">‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedTasks">0</div>
                <div class="stat-label">‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="readingStreak">0</div>
                <div class="stat-label">‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á (‡∏ß‡∏±‡∏ô)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completionRate">0%</div>
                <div class="stat-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
            </div>
        </div>

        <div class="toolbar">
            <button class="btn btn-primary" id="addTaskBtn">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡πà‡∏≤‡∏ô</button>
            <div class="month-navigation">
                <button class="month-nav-btn" id="prevMonth">‚Äπ</button>
                <div class="current-month" id="currentMonth"></div>
                <button class="month-nav-btn" id="nextMonth">‚Ä∫</button>
            </div>
        </div>

        <div class="calendar-container">
            <table class="calendar">
                <thead>
                    <tr>
                        <th>‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</th><th>‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå</th><th>‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</th><th>‡∏û‡∏∏‡∏ò</th><th>‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ</th><th>‡∏®‡∏∏‡∏Å‡∏£‡πå</th><th>‡πÄ‡∏™‡∏≤‡∏£‡πå</th>
                    </tr>
                </thead>
                <tbody id="calendarBody"></tbody>
            </table>
        </div>

        <div class="task-list-container">
            <div class="task-list">
                <h3 style="margin-bottom: 15px; color: var(--text-color);">üìã ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                <div id="todayTasks"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡πà‡∏≤‡∏ô</h3>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>
            <form id="taskForm">
                <input type="hidden" id="taskId">
                <div class="form-group">
                    <label class="form-label">‡∏ß‡∏¥‡∏ä‡∏≤ / ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô üìñ</label>
                    <input type="text" class="form-input" id="bookTitle" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏£‡∏∏‡∏õ‡∏ä‡∏µ‡∏ß‡∏∞‡∏ö‡∏ó‡∏ó‡∏µ‡πà 5" required>
                </div>
                <div class="form-group">
                    <label class="form-label">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ üéØ</label>
                    <input type="text" class="form-input" id="readingGoal" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡πà‡∏≤‡∏ô‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1-3, ‡∏ó‡∏≥‡πÇ‡∏à‡∏ó‡∏¢‡πå 20 ‡∏Ç‡πâ‡∏≠">
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà üóìÔ∏è</label>
                    <input type="date" class="form-input" id="taskDate" required>
                </div>
                 <div class="form-group">
                    <label class="form-label">‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‚è∞</label>
                    <input type="time" class="form-input" id="taskTime">
                </div>
                <div class="form-group">
                    <label class="form-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‚≠ê</label>
                    <select class="form-input" id="taskPriority">
                        <option value="low">‡πÑ‡∏°‡πà‡∏£‡∏µ‡∏ö</option>
                        <option value="medium" selected>‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                        <option value="high">‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </form>
        </div>
    </div>

    <script>
        // === ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ===
        let currentDate = new Date();
        let selectedDate = null;
        let readingTasks = JSON.parse(localStorage.getItem('readingTasksV2')) || {};

        const monthNames = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];

        // === ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ===
        document.addEventListener('DOMContentLoaded', function() {
            initializeCalendar();
            setupEventListeners();
            loadProfileImage();
        });

        // === ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Event Listeners ===
        function setupEventListeners() {
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                initializeCalendar();
            });
            document.getElementById('nextMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                initializeCalendar();
            });
            document.getElementById('addTaskBtn').addEventListener('click', () => openTaskModal());
            document.getElementById('closeModal').addEventListener('click', closeTaskModal);
            document.getElementById('taskForm').addEventListener('submit', handleTaskSubmit);
            document.getElementById('taskModal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('taskModal')) closeTaskModal();
            });
            document.getElementById('profileFrame').addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file'; input.accept = 'image/*';
                input.onchange = handleProfileImage;
                input.click();
            });
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'n') { e.preventDefault(); openTaskModal(); }
                if (e.key === 'Escape') closeTaskModal();
            });
        }
        
        // === ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå ===
        function handleProfileImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    localStorage.setItem('profileImageV2', e.target.result);
                    loadProfileImage();
                };
                reader.readAsDataURL(file);
            }
        }
        function loadProfileImage() {
            const savedImage = localStorage.getItem('profileImageV2');
            const profileFrame = document.getElementById('profileFrame');
            if (savedImage) {
                profileFrame.innerHTML = `<img src="${savedImage}" alt="Profile">`;
            }
        }

        // === ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô ===
        function initializeCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year + 543}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const calendarBody = document.getElementById('calendarBody');
            calendarBody.innerHTML = '';
            
            let date = 1;
            let dayOfWeek = firstDay.getDay();

            for (let i = 0; i < 6; i++) {
                if (date > lastDay.getDate()) break;
                const row = document.createElement('tr');
                for (let j = 0; j < 7; j++) {
                    const cell = document.createElement('td');
                    if (i === 0 && j < dayOfWeek) {
                        cell.classList.add('other-month');
                    } else if (date > lastDay.getDate()) {
                        cell.classList.add('other-month');
                    } else {
                        const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                        cell.innerHTML = `<div class="date-number">${date}</div>`;
                        
                        const today = new Date();
                        if (date === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                            cell.classList.add('today');
                        }

                        // ‡πÅ‡∏™‡∏î‡∏á Task ‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
                        if (readingTasks[dateKey]) {
                            readingTasks[dateKey].forEach(task => {
                                const taskEl = document.createElement('div');
                                taskEl.className = `reading-task ${task.completed ? 'completed' : ''}`;
                                taskEl.textContent = `üìñ ${task.bookTitle}`;
                                taskEl.title = task.bookTitle;
                                taskEl.addEventListener('click', (e) => {
                                    e.stopPropagation(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ modal ‡πÄ‡∏õ‡∏¥‡∏î
                                    toggleTaskCompletion(dateKey, task.id);
                                });
                                cell.appendChild(taskEl);
                            });
                        }
                        
                        cell.addEventListener('click', () => openTaskModal(dateKey));
                        date++;
                    }
                    row.appendChild(cell);
                }
                calendarBody.appendChild(row);
            }
            updateAllUI();
        }

        // === ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏°‡∏î‡∏±‡∏•‡πÅ‡∏•‡∏∞‡∏ü‡∏≠‡∏£‡πå‡∏° ===
        function openTaskModal(dateKey = null) {
            document.getElementById('taskForm').reset();
            const modal = document.getElementById('taskModal');
            if (dateKey) {
                document.getElementById('taskDate').value = dateKey;
            } else {
                 document.getElementById('taskDate').value = new Date().toISOString().split('T')[0];
            }
            modal.classList.add('show');
        }
        function closeTaskModal() { document.getElementById('taskModal').classList.remove('show'); }
        function handleTaskSubmit(e) {
            e.preventDefault();
            const formData = {
                id: Date.now(),
                bookTitle: document.getElementById('bookTitle').value,
                readingGoal: document.getElementById('readingGoal').value,
                date: document.getElementById('taskDate').value,
                time: document.getElementById('taskTime').value,
                priority: document.getElementById('taskPriority').value,
                completed: false,
            };
            if (!readingTasks[formData.date]) readingTasks[formData.date] = [];
            readingTasks[formData.date].push(formData);
            saveData();
            closeTaskModal();
            initializeCalendar();
            showNotification(`‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏° '${formData.bookTitle}' ‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏π‡πâ‡πÜ‡∏≠‡∏¥‡∏´‡∏°‡∏≤‡∏≠‡πâ‡∏ß‡∏ô`, 'success');
        }

        // === ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Task ===
        function toggleTaskCompletion(dateKey, taskId) {
            const task = readingTasks[dateKey].find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                saveData();
                initializeCalendar();
                const message = task.completed ? `üéâ ‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏à‡∏£‡πâ! ‡∏ó‡∏≥ '${task.bookTitle}' ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß` : `üìñ ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡πà‡∏≤‡∏ô '${task.bookTitle}' ‡∏ï‡πà‡∏≠`;
                showNotification(message, task.completed ? 'success' : 'info');
            }
        }
        
        // === ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ===
        function updateAllUI(){
            updateStats();
            showTodayTasks();
        }
        
        // === ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ===
        function updateStats() {
            let total = 0, completed = 0;
            const allDates = Object.keys(readingTasks).sort();
            
            allDates.forEach(date => {
                const dayTasks = readingTasks[date];
                total += dayTasks.length;
                completed += dayTasks.filter(t => t.completed).length;
            });
            
            let streak = 0;
            let checkDate = new Date();
            while(true){
                const dateKey = checkDate.toISOString().split('T')[0];
                if(readingTasks[dateKey] && readingTasks[dateKey].some(t => t.completed)){
                    streak++;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }
            
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;
            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('readingStreak').textContent = streak;
            document.getElementById('completionRate').textContent = `${rate}%`;
        }

        // === ‡πÅ‡∏™‡∏î‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ===
        function showTodayTasks() {
            const todayKey = new Date().toISOString().split('T')[0];
            const todayTasks = readingTasks[todayKey] || [];
            const container = document.getElementById('todayTasks');
            container.innerHTML = '';

            if (todayTasks.length === 0) {
                container.innerHTML = `<p style="text-align:center; color:#aaa; padding: 20px 0;">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡∏¢‡∏ô‡∏∞ üòä</p>`;
                return;
            }
            todayTasks.forEach(task => {
                const item = document.createElement('div');
                item.className = 'task-item';
                item.innerHTML = `
                    <div class="task-checkbox ${task.completed ? 'completed' : ''}" onclick="toggleTaskCompletion('${todayKey}', ${task.id})"></div>
                    <div style="flex: 1; ${task.completed ? 'text-decoration: line-through; opacity: 0.7;' : ''}">
                        <div style="font-weight: 500;">üìñ ${task.bookTitle}</div>
                        ${task.readingGoal ? `<div style="color: #888; font-size: 0.9rem;">üéØ ${task.readingGoal}</div>` : ''}
                        ${task.time ? `<div style="color: #888; font-size: 0.9rem;">‚è∞ ${task.time}</div>` : ''}
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // === ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ===
        function saveData() {
            localStorage.setItem('readingTasksV2', JSON.stringify(readingTasks));
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed; top: 20px; right: -320px;
                background-color: ${type === 'success' ? 'var(--completed-color)' : 'var(--primary-color)'};
                color: white; padding: 15px 20px; border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); z-index: 10000;
                font-family: var(--main-font); font-weight: 500;
                max-width: 300px; transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            `;
            document.body.appendChild(notification);
            setTimeout(() => { notification.style.right = '20px'; }, 100);
            setTimeout(() => {
                notification.style.right = '-320px';
                setTimeout(() => { document.body.removeChild(notification); }, 500);
            }, 3500);
        }

        console.log("üíñ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ô‡∏∞!");
    </script>
</body>
</html>